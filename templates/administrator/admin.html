<!-- 管理员审核界面：审核出行 & 审批商户提现 -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理员 - 审核中心</title>
  <link rel="stylesheet" href="../../static/css/style.css">
</head>
<body>
  <div class="dashboard">
    <nav class="dash-nav">
      <div class="brand">绿色出行管理平台</div>
      <a href="#" class="active">审核中心 <span></span></a>
      <a href="{{ url_for("admin.admin_users") }}">账户管理</a>
      <a href="{{ url_for("admin.point_rules") }}">积分兑换规则</a>
      <a href="{{ url_for("user.index") }}">退出登录</a>
    </nav>

    <div class="dash-main">
      <div class="dash-header">
        <div>
          <h1>审核控制台</h1>
          <p>实时处理出行、提现与积分流转，保证绿色积分安全。</p>
        </div>
        <span class="pill pulse">在线 · 审核中</span>
      </div>

      <div class="stat-grid">
        <div class="stat-card hover-lift">
          <span>待审核出行</span>
          <strong id="metricPendingTrips">—</strong>
          <p style="color:var(--muted);margin-top:6px;">来自用户的待处理记录</p>
        </div>
        <div class="stat-card hover-lift">
          <span>提现申请</span>
          <strong id="metricWithdrawals">—</strong>
          <p style="color:var(--muted);margin-top:6px;">商户积分兑换现金</p>
        </div>
        <div class="stat-card hover-lift">
          <span>积分波动</span>
          <strong id="metricPoints">—</strong>
          <p style="color:var(--muted);margin-top:6px;">今日积分总变化</p>
        </div>
      </div>

      <div class="panel hover-lift">
        <div class="panel-header">
          <h2>待审核出行记录</h2>
          <span class="pill">优先处理</span>
        </div>
        <div id="pendingTrips" class="scroll-container"></div>
      </div>

      <div class="panel hover-lift">
        <div class="panel-header">
          <h2>商户提现申请</h2>
          <span class="pill orange">需 1 个工作日</span>
        </div>
        <div id="withdrawalRequests" class="scroll-container"></div>
      </div>

      <div class="panel hover-lift">
        <div class="panel-header">
          <h2>积分流转记录</h2>
        </div>
        <div id="pointRecords" class="scroll-container"></div>
      </div>
    </div>
  </div>

  <script src="../../static/js/script.js"></script>
  <script src="../../static/js/welcome_bar_enhanced.js"></script>
<script>
// 页面加载完成后确保初始化
document.addEventListener('DOMContentLoaded', function() {
  console.log('Admin page DOM loaded');

  // 延迟执行，确保 script.js 中的函数已加载
  setTimeout(() => {
    console.log('Initializing admin review...');

    try {
      // 检查函数是否存在
      console.log('Checking functions...');
      console.log('fetchPendingTrips:', typeof fetchPendingTrips);
      console.log('fetchWithdrawalRequests:', typeof fetchWithdrawalRequests);
      console.log('fetchPointRecords:', typeof fetchPointRecords);

      // 获取待审核出行
      if (typeof fetchPendingTrips === 'function') {
        console.log('Fetching pending trips...');
        fetchPendingTrips().catch(err => console.error('fetchPendingTrips error:', err));
      } else {
        console.error('fetchPendingTrips function not found');
      }

      // 获取提现申请
      if (typeof fetchWithdrawalRequests === 'function') {
        console.log('Fetching withdrawal requests...');
        fetchWithdrawalRequests().catch(err => console.error('fetchWithdrawalRequests error:', err));
      } else {
        console.error('fetchWithdrawalRequests function not found');
      }

      // 获取积分记录
      if (typeof fetchPointRecords === 'function') {
        console.log('Fetching point records...');
        fetchPointRecords().catch(err => console.error('fetchPointRecords error:', err));
      } else {
        console.error('fetchPointRecords function not found');
      }
    } catch (error) {
      console.error('页面初始化错误:', error);
    }
  }, 500); // 增加延迟时间
});
</script>
</body>
</html>
